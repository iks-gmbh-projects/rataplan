<h3>Abstimmungsoptionen</h3>
<div class="left-bound" [formGroup]="vote">
  <div>
    <mat-form-field class="vote-option-form-field">
      <mat-label>Max. Teilnehmerzahl</mat-label>
      <input
        matInput
        formControlName="participantLimit"
        type="number"
        style="text-align: center"
        (input)="handleParticipantLimitChange($event)">
    </mat-form-field>
  </div>
  <div *ngIf="voteConfig.startDate || voteConfig.startTime">
    <mat-form-field appearance="fill">
      <mat-label [textContent]="startLabel"></mat-label>
      <input
        type="text"
        formControlName="startDateInput"
        [mtxDatetimepicker]="picker"
        matInput
        [required]="voteConfig.startDate || voteConfig.startTime ?? false"
        (dateInput)="(onlyOneOptionSelected && addVoteOption())"
      >
      <mtx-datetimepicker-toggle [for]="picker" matSuffix></mtx-datetimepicker-toggle>
      <mtx-datetimepicker [type]="startType" #picker></mtx-datetimepicker>
      <mat-error>{{ errorMessageService.genericFormError(vote.get('startDateInput')) }}</mat-error>
    </mat-form-field>
  </div>
  <div *ngIf="voteConfig.endDate || voteConfig.endTime">
    <mat-form-field class="vote-option-form-field" appearance="fill">
      <mat-label [textContent]="endLabel"></mat-label>
      <input
        type="text"
        formControlName="endDateInput"
        [mtxDatetimepicker]="picker"
        [min]="vote.value.startDateInput ?? null"
        matInput
        [required]="voteConfig.endDate || voteConfig.endTime ?? false"
        (dateInput)="onlyOneOptionSelected && addVoteOption()"
      >
      <mtx-datetimepicker-toggle [for]="picker" matSuffix></mtx-datetimepicker-toggle>
      <mtx-datetimepicker [type]="endType" [startAt]="vote.value.startDateInput ?? null" #picker></mtx-datetimepicker>
      <mat-error>{{ errorMessageService.genericFormError(vote.get('endDateInput')) }}</mat-error>
    </mat-form-field>
  </div>
  <div *ngIf="voteConfig.description">
    <mat-form-field
      class="vote-option-form-field"
      appearance="fill"
    >
      <mat-label>Beschreibung</mat-label>
      <input
        type="text"
        formControlName="descriptionInput"
        autocomplete="off"
        matInput
        [required]="voteConfig.description"
        (keydown.enter)="(!vote.invalid && addVoteOption())"
      >
      <mat-error>{{ errorMessageService.genericFormError(vote.get('descriptionInput')) }}</mat-error>
    </mat-form-field>
  </div>
  <div *ngIf="voteConfig.url">
    <mat-form-field
      class="vote-option-form-field"
      appearance="fill"
    >
      <mat-label>URL</mat-label>
      <input
        type="text"
        formControlName="linkInput"
        autocomplete="off"
        matInput
        [required]="voteConfig.url"
        (keydown.enter)="(!vote.invalid && addVoteOption())"
      >
      <mat-error>{{ errorMessageService.genericFormError(vote.get('linkInput')) }}</mat-error>
    </mat-form-field>
  </div>
  <div style="display: inline; margin-top: 1rem">
    <button
      mat-button
      color="warn"
      [hidden]="onlyOneOptionSelected && !voteConfig.url && !voteConfig.description"
      (click)="clearContent()"
    >Zurücksetzen
    </button>
    <button
      mat-raised-button
      color="primary"
      [disabled]="vote.invalid"
      [hidden]="onlyOneOptionSelected && !voteConfig.url && !voteConfig.description"
      (click)="addVoteOption()"
    >
      {{ vote.value.voteIndex === null ? 'Hinzufügen' : 'Ändern' }}
    </button>
  </div>
  <p>
    <b> Erstellte Abstimmungsoptionen: {{ voteOptions.length }} </b>
  </p>
  <div *ngFor="let voteOption of voteOptions; let index = index" style="display: flex; width: 100%"
  >
    <div class="show-vote-options">
      <div *ngIf="voteConfig.startDate">
        {{ voteOption.startDate | date:(this.voteConfig.startTime ? 'dd.MM.yyyy HH:mm' : 'dd.MM.yyyy'):undefined:'de' }}
        <ng-template [ngIf]="voteConfig.endDate || voteConfig.endTime">
          {{ voteOption.endDate | date:(this.voteConfig.endTime ? '- dd.MM.yyyy HH:mm' : '- dd.MM.yyyy'):undefined:'de' }}
        </ng-template>
      </div>
      <div class="vote-option-description" *ngIf="this.voteConfig.description">
        {{ voteOption.description }}
      </div>
      <div *ngIf="this.voteConfig.url">
        <a [href]="voteOption.url">Link</a>
      </div>
      <div *ngIf="voteOption.participantLimit">
        Max. Teilnehmerzahl: {{ voteOption.participantLimit }}
      </div>
    </div>
    <div class="vote-option-buttons">
      <button
        mat-icon-button
        (click)="editVoteOption(index)"
      >
        <mat-icon>edit_square</mat-icon>
      </button>
      <button
        mat-icon-button color="warn"
        (click)="deleteVoteOption(index)"
      >
        <mat-icon>delete</mat-icon>
      </button>
    </div>
  </div>
  <div class="navigate-submit-multiple-button-space">
    <button
      mat-icon-button
      routerLink="../configurationOptions"
    >
      <mat-icon>navigate_before</mat-icon>
    </button>
    <button
      [disabled]="this.voteOptions.length == 0"
      type="submit"
      color="primary"
      mat-icon-button
      routerLink="../email"
    >
      <mat-icon>navigate_next</mat-icon>
    </button>
  </div>
</div>