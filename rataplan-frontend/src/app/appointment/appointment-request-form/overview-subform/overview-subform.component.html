<div [formGroup]='voteOptions'>
  <mat-card style='min-width: 80%'>
    <mat-card-header>
      <mat-card-title>Abstimmungoption</mat-card-title>
    </mat-card-header>
    <div *ngIf='appointmentConfig.startDate && !appointmentConfig.endDate'>
      <mat-form-field appearance='fill'>
        <mat-label>Datum</mat-label>
        <input autocomplete='off'
               formControlName='startDateInput'
               matInput
               [matDatepicker]='picker'
               required>
        <mat-datepicker-toggle matSuffix
                               [for]='picker'></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
        <mat-error>{{errorMessageService.genericFormError(voteOptions.get('startDateInput'))}}</mat-error>
      </mat-form-field>
    </div>
    <div *ngIf='!appointmentConfig.startDate && appointmentConfig.endDate'>
      <mat-form-field appearance='fill'>
        <mat-label>Datum</mat-label>
        <input autocomplete='off'
               formControlName='endDateInput'
               matInput
               [matDatepicker]='picker'
               required>
        <mat-datepicker-toggle matSuffix
                               [for]='picker'></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
        <mat-error>{{errorMessageService.genericFormError(voteOptions.get('endDateInput'))}}</mat-error>
      </mat-form-field>
    </div>
    <div *ngIf='appointmentConfig.startDate && appointmentConfig.endDate'>
      <mat-form-field appearance='fill'>
        <mat-label>Zeitraum</mat-label>
        <mat-date-range-input [rangePicker]='picker'>
          <input matStartDate
                 formControlName='startDateInput'
                 placeholder='Start Date'
                 required
                 (dateChange)='voteOptions.get("endTimeInput")?.updateValueAndValidity()'>
          <input matEndDate
                 formControlName='endDateInput'
                 placeholder='End Date'
                 required
                 (dateChange)='voteOptions.get("startTimeInput")?.updateValueAndValidity()'>
        </mat-date-range-input>
        <mat-datepicker-toggle matSuffix
                               [for]='picker'></mat-datepicker-toggle>
        <mat-date-range-picker #picker></mat-date-range-picker>
        <mat-error>{{errorMessageService.genericFormError(voteOptions.get('startDateInput'))}}</mat-error>
        <mat-error>{{errorMessageService.genericFormError(voteOptions.get('endDateInput'))}}</mat-error>
      </mat-form-field>
    </div>
    <div *ngIf='appointmentConfig.startTime'>
      <mat-form-field floatLabel='never'
                      appearance='fill'>
        <mat-label>{{ appointmentConfig.endTime ? "Startzeit" : "Uhrzeit"}}</mat-label>
        <input matInput
               formControlName='startTimeInput'
               aria-label='24hr format'
               [ngxTimepicker]='fullTime'
               [format]='24'
               [combinedDatetimeMax]='appointmentConfig.endTime && voteOptions.get("endTimeInput")'
               [referenceDate]='appointmentConfig.endDate && voteOptions.get("endDateInput")'
               [date]='appointmentConfig.startDate && voteOptions.get("startDateInput")'
               [ignoreDate]='!appointmentConfig.startDate || !appointmentConfig.endDate'
               required
               readonly
               (ngModelChange)='voteOptions.get("endTimeInput")?.updateValueAndValidity()'>
        <ngx-material-timepicker #fullTime></ngx-material-timepicker>
        <mat-error>{{errorMessageService.genericFormError(voteOptions.get('startTimeInput'))}}</mat-error>
      </mat-form-field>
    </div>
    <div *ngIf='appointmentConfig.endTime'>
      <mat-form-field floatLabel='never'
                      appearance='fill'>
        <mat-label>Endzeit</mat-label>
        <input matInput
               formControlName='endTimeInput'
               aria-label='24hr format'
               [ngxTimepicker]='fullTime'
               [format]='24'
               [combinedDatetimeMin]='appointmentConfig.startTime && voteOptions.get("startTimeInput")'
               [referenceDate]='appointmentConfig.startDate && voteOptions.get("startDateInput")'
               [date]='appointmentConfig.endDate && voteOptions.get("endDateInput")'
               [ignoreDate]='!appointmentConfig.startDate || !appointmentConfig.endDate'
               required
               readonly
               (ngModelChange)='voteOptions.get("startTimeInput")?.updateValueAndValidity()'>
        <ngx-material-timepicker #fullTime></ngx-material-timepicker>
        <mat-error>{{errorMessageService.genericFormError(voteOptions.get('endTimeInput'))}}</mat-error>
      </mat-form-field>
    </div>
    <div *ngIf='appointmentConfig.description'>
      <mat-form-field appearance='fill'
                      >
        <mat-label>Textfeld</mat-label>
        <input type='text'
               formControlName='descriptionInput'
               autocomplete='off'
               matInput
               required>
        <mat-error>{{errorMessageService.genericFormError(voteOptions.get('descriptionInput'))}}</mat-error>
      </mat-form-field>
    </div>
    <div *ngIf='appointmentConfig.url'>
      <mat-form-field appearance='fill'
                      >
        <mat-label>URL</mat-label>
        <input type='text'
               formControlName='linkInput'
               autocomplete='off'
               matInput
               required>
        <mat-error>{{errorMessageService.genericFormError(voteOptions.get('linkInput'))}}</mat-error>
      </mat-form-field>
    </div>
    <mat-card-actions>
      <button mat-button
              (click)='clearContent()'>Zurücksetzen
      </button>
      <button mat-button
              [disabled]='voteOptions.invalid || voteOptions.untouched'
              (click)='addVoteOption()'>
        {{ voteOptions.value.appointmentIndex === null ? 'Hinzufügen' : 'Ändern' }}
      </button>
    </mat-card-actions>
  </mat-card>
</div>
<div style='margin-top: 20px; margin-bottom: 20px'>
  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title>
        Erstellte Abstimmungsoptionen: {{ appointments.length }}
      </mat-panel-title>
    </mat-expansion-panel-header>
    <ng-template matExpansionPanelContent>
      <div class="vote-option" *ngFor='let voteOption of this.appointments; let index = index'>
        <div>
          <div *ngIf='appointmentConfig.startDate'>
            {{ voteOption.startDate | date:(this.appointmentConfig.startTime ? 'dd.MM.yyyy HH:mm' : 'dd.MM.yyyy'):undefined:'de' }}
            <ng-template [ngIf]='appointmentConfig.endDate || appointmentConfig.endTime'>
              {{ voteOption.endDate | date:(this.appointmentConfig.endTime ? '- dd.MM.yyyy HH:mm' : '- dd.MM.yyyy'):undefined:'de' }}
            </ng-template>
          </div>
          <p class="vote-option-description" *ngIf='this.appointmentConfig.description'>
            {{ voteOption.description }}
          </p>
          <div *ngIf='this.appointmentConfig.url'>
            <a [href]='voteOption.url'>Link</a>
          </div>
        </div>
        <div class="vote-option-buttons">
          <button mat-icon-button
                  (click)='editVoteOption(index)'>
            <mat-icon mat-list-icon>edit_square</mat-icon>
          </button>
          <button mat-icon-button color="warn"
                  (click)='deleteVoteOption(index)'>
            <mat-icon mat-list-icon>delete</mat-icon>
          </button>
        </div>
      </div>
    </ng-template>
  </mat-expansion-panel>
</div>
<div>
  <button mat-raised-button
          routerLink='../configurationOptions'>Zurück
  </button>
  <button [disabled]='this.appointments.length == 0'
          class='right'
          type='submit'
          color='primary'
          mat-raised-button
          routerLink='../email'>Weiter
  </button>
</div>

