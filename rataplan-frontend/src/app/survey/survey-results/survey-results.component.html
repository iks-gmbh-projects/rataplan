<div class="wrapper">
  <ng-template #missing>
    <h3>Umfrage existiert nicht</h3>
    <p>Wie sind sie hierhin gekommen?</p>
  </ng-template>
  <ng-template [ngIf]="survey" [ngIfElse]="missing">
    <h3>{{survey.name}}</h3>
    <mat-spinner *ngIf="busy; else finished"></mat-spinner>
    <ng-template #finished>
      <div *ngIf="error; else success">Fehler beim Laden der Daten</div>
      <ng-template #success>
        <div class="bottomspace" *ngFor="let group of survey.questionGroups">
          <h4>{{group.title}}</h4>
          <div class="bottomspace" *ngFor="let question of group.questions">
            <mat-expansion-panel *ngIf="question.id">
              <mat-expansion-panel-header>
                <mat-panel-title>{{question.text}}</mat-panel-title>
              </mat-expansion-panel-header>
              <table mat-table matSort [dataSource]="answers">
                <ng-container matColumnDef="user">
                  <th mat-header-cell mat-sort-header *matHeaderCellDef>Beantworter</th>
                  <td mat-cell *matCellDef="let answer">{{answer.userId || "Anonym"}}</td>
                </ng-container>
                <ng-template [ngIf]="question.checkboxGroup">
                  <ng-container *ngFor="let checkbox of question.checkboxGroup.checkboxes"
                    [matColumnDef]="'checkbox'+checkbox.id!">
                    <th mat-header-cell mat-sort-header *matHeaderCellDef> {{checkbox.text}} </th>
                    <td mat-cell *matCellDef="let answer">
                      <mat-icon>{{toCheckbox(answer.answers[question.id].checkboxes[checkbox.id!])}}
                      </mat-icon>
                    </td>
                  </ng-container>
                </ng-template>
                <ng-container matColumnDef="answer">
                  <th mat-header-cell mat-sort-header *matHeaderCellDef> Freitextantwort </th>
                  <td mat-cell *matCellDef="let answer">{{answer.answers[question.id].text}}</td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="columns[question.id]"></tr>
                <tr mat-row *matRowDef="let row; columns: columns[question.id]"></tr>
              </table>
            </mat-expansion-panel>
          </div>
        </div>
        <button mat-icon-button color="primary" (click)="downloadResults()">
          <mat-icon>download</mat-icon>
        </button><br>
      </ng-template>
    </ng-template>
  </ng-template>
  <a mat-raised-button color="primary" routerLink="..">Zur√ºck</a>
</div>